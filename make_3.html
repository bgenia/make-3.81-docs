<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html401/loose.dtd">
<html>
<!-- This file documents the GNU make utility, which determines
automatically which pieces of a large program need to be recompiled,
and issues the commands to recompile them.

This is Edition 0.70, last updated 1 April 2006,
of The GNU Make Manual, for GNU make version 3.81.

Copyright C 1988, 1989, 1990, 1991, 1992, 1993, 1994, 1995,
1996, 1997, 1998, 1999, 2000, 2002, 2003, 2004, 2005, 2006
Free Software Foundation, Inc.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.2 or
any later version published by the Free Software Foundation; with no
Invariant Sections, with the Front-Cover Texts being "A GNU Manual,"
and with the Back-Cover Texts as in (a) below.  A copy of the
license is included in the section entitled "GNU Free Documentation
License."

(a) The FSF's Back-Cover Text is: "You have freedom to copy and modify
this GNU Manual, like GNU software.  Copies published by the Free
Software Foundation raise funds for GNU development."

 -->
<!-- Created on October 20, 2021 by texi2html 1.82
texi2html was written by: 
            Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Many creative people.
Send bugs and suggestions to <texi2html-bug@nongnu.org>
-->
<head>
<title>GNU make: 3. Writing Makefiles</title>

<meta name="description" content="GNU make: 3. Writing Makefiles">
<meta name="keywords" content="GNU make: 3. Writing Makefiles">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html 1.82">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.smallquotation {font-size: smaller}
pre.display {font-family: serif}
pre.format {font-family: serif}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: serif; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: serif; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.roman {font-family:serif; font-weight:normal;}
span.sansserif {font-family:sans-serif; font-weight:normal;}
ul.toc {list-style: none}
-->
</style>

<link rel="stylesheet" type="text/css" href="manual.css">

</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">

<a name="Makefiles"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="make_2.html#Cleanup" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Makefile-Contents" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="make_2.html#Introduction" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="make.html#Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="make_4.html#Rules" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="make.html#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="make_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="make_19.html#Concept-Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="make_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Writing-Makefiles"></a>
<h1 class="chapter">3. Writing Makefiles</h1>

<a name="index-makefile_002c-how-to-write"></a>
<p>The information that tells <code>make</code> how to recompile a system comes from
reading a data base called the <em>makefile</em>.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Makefile-Contents">3.1 What Makefiles Contain</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">           What makefiles contain.
</td></tr>
<tr><td align="left" valign="top"><a href="#Makefile-Names">3.2 What Name to Give Your Makefile</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">              How to name your makefile.
</td></tr>
<tr><td align="left" valign="top"><a href="#Include">3.3 Including Other Makefiles</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">                     How one makefile can use another makefile.
</td></tr>
<tr><td align="left" valign="top"><a href="#MAKEFILES-Variable">3.4 The Variable <code>MAKEFILES</code></a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">          The environment can specify extra makefiles.
</td></tr>
<tr><td align="left" valign="top"><a href="#MAKEFILE_005fLIST-Variable">3.5 The Variable <code>MAKEFILE_LIST</code></a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">      Discover which makefiles have been read.
</td></tr>
<tr><td align="left" valign="top"><a href="#Special-Variables">3.6 Other Special Variables</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">           Other special variables.
</td></tr>
<tr><td align="left" valign="top"><a href="#Remaking-Makefiles">3.7 How Makefiles Are Remade</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">          How makefiles get remade.
</td></tr>
<tr><td align="left" valign="top"><a href="#Overriding-Makefiles">3.8 Overriding Part of Another Makefile</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">        How to override part of one makefile
                                  with another makefile.
</td></tr>
<tr><td align="left" valign="top"><a href="#Reading-Makefiles">3.9 How <code>make</code> Reads a Makefile</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">           How makefiles are parsed.
</td></tr>
<tr><td align="left" valign="top"><a href="#Secondary-Expansion">3.10 Secondary Expansion</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">         How and when secondary expansion is performed.
</td></tr>
</table>

<hr size="6">
<a name="Makefile-Contents"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Makefiles" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Makefile-Names" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Makefiles" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Makefiles" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="make_4.html#Rules" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="make.html#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="make_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="make_19.html#Concept-Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="make_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="What-Makefiles-Contain"></a>
<h2 class="section">3.1 What Makefiles Contain</h2>

<p>Makefiles contain five kinds of things: <em>explicit rules</em>,
<em>implicit rules</em>, <em>variable definitions</em>, <em>directives</em>,
and <em>comments</em>.  Rules, variables, and directives are described at
length in later chapters.
</p>
<ul>
<li><a name="index-rule_002c-explicit_002c-definition-of"></a>
<a name="index-explicit-rule_002c-definition-of"></a>
</li><li>
An <em>explicit rule</em> says when and how to remake one or more files,
called the rule&rsquo;s <em>targets</em>.  It lists the other files that the
targets depend on, called the <em>prerequisites</em> of the target, and
may also give commands to use to create or update the targets.
See section <a href="make_4.html#Rules">Writing Rules</a>.

<a name="index-rule_002c-implicit_002c-definition-of"></a>
<a name="index-implicit-rule_002c-definition-of"></a>
</li><li>
An <em>implicit rule</em> says when and how to remake a class of files
based on their names.  It describes how a target may depend on a file
with a name similar to the target and gives commands to create or
update such a target.  See section <a href="make_10.html#Implicit-Rules">Using Implicit Rules</a>.

<a name="index-variable-definition"></a>
</li><li>
A <em>variable definition</em> is a line that specifies a text string
value for a variable that can be substituted into the text later.  The
simple makefile example shows a variable definition for <code>objects</code>
as a list of all object files (see section <a href="make_2.html#Variables-Simplify">Variables Make Makefiles Simpler</a>).

<a name="index-directive"></a>
</li><li>
A <em>directive</em> is a command for <code>make</code> to do something special while
reading the makefile.  These include:

<ul>
<li>
Reading another makefile (see section <a href="#Include">Including Other Makefiles</a>).

</li><li>
Deciding (based on the values of variables) whether to use or
ignore a part of the makefile (see section <a href="make_7.html#Conditionals">Conditional Parts of Makefiles</a>).

</li><li>
Defining a variable from a verbatim string containing multiple lines
(see section <a href="make_6.html#Defining">Defining Variables Verbatim</a>).
</li></ul>

<a name="index-comments_002c-in-makefile"></a>
<a name="index-_0023-_0028comments_0029_002c-in-makefile"></a>
</li><li>
&lsquo;<samp>#</samp>&rsquo; in a line of a makefile starts a <em>comment</em>.  It and the
rest of the line are ignored, except that a trailing backslash not
escaped by another backslash will continue the comment across multiple
lines.  A line containing just a comment (with perhaps spaces before
it) is effectively blank, and is ignored.  If you want a literal
<code>#</code>, escape it with a backslash (e.g., <code>\#</code>).  Comments may
appear on any line in the makefile, although they are treated
specially in certain situations.

<p>Within a command script (if the line begins with a TAB character) the
entire line is passed to the shell, just as with any other line that
begins with a TAB.  The shell decides how to interpret the text:
whether or not this is a comment is up to the shell.
</p>
<p>Within a <code>define</code> directive, comments are not ignored during the
definition of the variable, but rather kept intact in the value of the
variable.  When the variable is expanded they will either be treated
as <code>make</code> comments or as command script text, depending on the
context in which the variable is evaluated.
</p></li></ul>

<hr size="6">
<a name="Makefile-Names"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Makefile-Contents" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Include" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Makefiles" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Makefiles" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="make_4.html#Rules" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="make.html#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="make_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="make_19.html#Concept-Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="make_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="What-Name-to-Give-Your-Makefile"></a>
<h2 class="section">3.2 What Name to Give Your Makefile</h2>
<a name="index-makefile-name"></a>
<a name="index-name-of-makefile"></a>
<a name="index-default-makefile-name"></a>
<a name="index-file-name-of-makefile"></a>

<p>By default, when <code>make</code> looks for the makefile, it tries the
following names, in order: &lsquo;<tt>GNUmakefile</tt>&rsquo;, &lsquo;<tt>makefile</tt>&rsquo;
and &lsquo;<tt>Makefile</tt>&rsquo;.
<a name="index-Makefile"></a>
<a name="index-GNUmakefile"></a>
<a name="index-makefile-1"></a>
</p>
<a name="index-README"></a>
<p>Normally you should call your makefile either &lsquo;<tt>makefile</tt>&rsquo; or
&lsquo;<tt>Makefile</tt>&rsquo;.  (We recommend &lsquo;<tt>Makefile</tt>&rsquo; because it appears
prominently near the beginning of a directory listing, right near other
important files such as &lsquo;<tt>README</tt>&rsquo;.)  The first name checked,
&lsquo;<tt>GNUmakefile</tt>&rsquo;, is not recommended for most makefiles.  You should
use this name if you have a makefile that is specific to GNU
<code>make</code>, and will not be understood by other versions of
<code>make</code>.  Other <code>make</code> programs look for &lsquo;<tt>makefile</tt>&rsquo; and
&lsquo;<tt>Makefile</tt>&rsquo;, but not &lsquo;<tt>GNUmakefile</tt>&rsquo;.
</p>
<p>If <code>make</code> finds none of these names, it does not use any makefile.
Then you must specify a goal with a command argument, and <code>make</code>
will attempt to figure out how to remake it using only its built-in
implicit rules.  See section <a href="make_10.html#Implicit-Rules">Using Implicit Rules</a>.
</p>
<a name="index-_002df"></a>
<a name="index-_002d_002dfile"></a>
<a name="index-_002d_002dmakefile"></a>
<p>If you want to use a nonstandard name for your makefile, you can specify
the makefile name with the &lsquo;<samp>-f</samp>&rsquo; or &lsquo;<samp>--file</samp>&rsquo; option.  The
arguments &lsquo;<samp>-f <var>name</var></samp>&rsquo; or &lsquo;<samp>--file=<var>name</var></samp>&rsquo; tell
<code>make</code> to read the file <var>name</var> as the makefile.  If you use
more than one &lsquo;<samp>-f</samp>&rsquo; or &lsquo;<samp>--file</samp>&rsquo; option, you can specify several
makefiles.  All the makefiles are effectively concatenated in the order
specified.  The default makefile names &lsquo;<tt>GNUmakefile</tt>&rsquo;,
&lsquo;<tt>makefile</tt>&rsquo; and &lsquo;<tt>Makefile</tt>&rsquo; are not checked automatically if you
specify &lsquo;<samp>-f</samp>&rsquo; or &lsquo;<samp>--file</samp>&rsquo;.
<a name="index-specifying-makefile-name"></a>
<a name="index-makefile-name_002c-how-to-specify"></a>
<a name="index-name-of-makefile_002c-how-to-specify"></a>
<a name="index-file-name-of-makefile_002c-how-to-specify"></a>
</p>
<hr size="6">
<a name="Include"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Makefile-Names" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#MAKEFILES-Variable" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Makefiles" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Makefiles" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="make_4.html#Rules" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="make.html#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="make_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="make_19.html#Concept-Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="make_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Including-Other-Makefiles"></a>
<h2 class="section">3.3 Including Other Makefiles</h2>
<a name="index-including-other-makefiles"></a>
<a name="index-makefile_002c-including"></a>

<a name="index-include"></a>
<p>The <code>include</code> directive tells <code>make</code> to suspend reading the
current makefile and read one or more other makefiles before continuing.
The directive is a line in the makefile that looks like this:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">include <var>filenames</var>&hellip;
</pre></td></tr></table>

<p><var>filenames</var> can contain shell file name patterns.  If
<var>filenames</var> is empty, nothing is included and no error is printed.
<a name="index-shell-file-name-pattern-_0028in-include_0029"></a>
<a name="index-shell-wildcards-_0028in-include_0029"></a>
<a name="index-wildcard_002c-in-include"></a>
</p>
<p>Extra spaces are allowed and ignored at the beginning of the line, but
a tab is not allowed.  (If the line begins with a tab, it will be
considered a command line.)  Whitespace is required between
<code>include</code> and the file names, and between file names; extra
whitespace is ignored there and at the end of the directive.  A
comment starting with &lsquo;<samp>#</samp>&rsquo; is allowed at the end of the line.  If
the file names contain any variable or function references, they are
expanded.  See section <a href="make_6.html#Using-Variables">How to Use Variables</a>.
</p>
<p>For example, if you have three &lsquo;<tt>.mk</tt>&rsquo; files, &lsquo;<tt>a.mk</tt>&rsquo;,
&lsquo;<tt>b.mk</tt>&rsquo;, and &lsquo;<tt>c.mk</tt>&rsquo;, and <code>$(bar)</code> expands to
<code>bish bash</code>, then the following expression
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">include foo *.mk $(bar)
</pre></td></tr></table>

<p>is equivalent to
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">include foo a.mk b.mk c.mk bish bash
</pre></td></tr></table>

<p>When <code>make</code> processes an <code>include</code> directive, it suspends
reading of the containing makefile and reads from each listed file in
turn.  When that is finished, <code>make</code> resumes reading the
makefile in which the directive appears.
</p>
<p>One occasion for using <code>include</code> directives is when several programs,
handled by individual makefiles in various directories, need to use a
common set of variable definitions
(see section <a href="make_6.html#Setting">Setting Variables</a>) or pattern rules
(see section <a href="make_10.html#Pattern-Rules">Defining and Redefining Pattern Rules</a>).
</p>
<p>Another such occasion is when you want to generate prerequisites from
source files automatically; the prerequisites can be put in a file that
is included by the main makefile.  This practice is generally cleaner
than that of somehow appending the prerequisites to the end of the main
makefile as has been traditionally done with other versions of
<code>make</code>.  See section <a href="make_4.html#Automatic-Prerequisites">Generating Prerequisites Automatically</a>.
<a name="index-prerequisites_002c-automatic-generation"></a>
<a name="index-automatic-generation-of-prerequisites"></a>
<a name="index-generating-prerequisites-automatically"></a>
</p>
<a name="index-_002dI"></a>
<a name="index-_002d_002dinclude_002ddir"></a>
<a name="index-included-makefiles_002c-default-directories"></a>
<a name="index-default-directories-for-included-makefiles"></a>
<a name="index-_002fusr_002fgnu_002finclude"></a>
<a name="index-_002fusr_002flocal_002finclude"></a>
<a name="index-_002fusr_002finclude"></a>
<p>If the specified name does not start with a slash, and the file is not
found in the current directory, several other directories are searched.
First, any directories you have specified with the &lsquo;<samp>-I</samp>&rsquo; or
&lsquo;<samp>--include-dir</samp>&rsquo; option are searched
(see section <a href="make_9.html#Options-Summary">Summary of Options</a>).
Then the following directories (if they exist)
are searched, in this order:
&lsquo;<tt><var>prefix</var>/include</tt>&rsquo; (normally &lsquo;<tt>/usr/local/include</tt>&rsquo;
<a name="DOCF1" href="make_fot.html#FOOT1">(1)</a>)
&lsquo;<tt>/usr/gnu/include</tt>&rsquo;,
&lsquo;<tt>/usr/local/include</tt>&rsquo;, &lsquo;<tt>/usr/include</tt>&rsquo;.
</p>
<p>If an included makefile cannot be found in any of these directories, a
warning message is generated, but it is not an immediately fatal error;
processing of the makefile containing the <code>include</code> continues.
Once it has finished reading makefiles, <code>make</code> will try to remake
any that are out of date or don&rsquo;t exist.
See section <a href="#Remaking-Makefiles">How Makefiles Are Remade</a>.
Only after it has tried to find a way to remake a makefile and failed,
will <code>make</code> diagnose the missing makefile as a fatal error.
</p>
<p>If you want <code>make</code> to simply ignore a makefile which does not exist
and cannot be remade, with no error message, use the <code>-include</code>
directive instead of <code>include</code>, like this:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">-include <var>filenames</var>&hellip;
</pre></td></tr></table>

<p>This acts like <code>include</code> in every way except that there is no
error (not even a warning) if any of the <var>filenames</var> do not exist.
For compatibility with some other <code>make</code> implementations,
<code>sinclude</code> is another name for <code>-include</code>.
</p>
<hr size="6">
<a name="MAKEFILES-Variable"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Include" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#MAKEFILE_005fLIST-Variable" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Makefiles" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Makefiles" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="make_4.html#Rules" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="make.html#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="make_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="make_19.html#Concept-Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="make_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="The-Variable-MAKEFILES"></a>
<h2 class="section">3.4 The Variable <code>MAKEFILES</code></h2>
<a name="index-makefile_002c-and-MAKEFILES-variable"></a>
<a name="index-including-_0028MAKEFILES-variable_0029"></a>

<a name="index-MAKEFILES"></a>
<p>If the environment variable <code>MAKEFILES</code> is defined, <code>make</code>
considers its value as a list of names (separated by whitespace) of
additional makefiles to be read before the others.  This works much like
the <code>include</code> directive: various directories are searched for those
files (see section <a href="#Include">Including Other Makefiles</a>).  In addition, the
default goal is never taken from one of these makefiles and it is not an
error if the files listed in <code>MAKEFILES</code> are not found.
</p>
<a name="index-recursion_002c-and-MAKEFILES-variable"></a>
<p>The main use of <code>MAKEFILES</code> is in communication between recursive
invocations of <code>make</code> (see section <a href="make_5.html#Recursion">Recursive Use of <code>make</code></a>).  It usually is not desirable to set the environment
variable before a top-level invocation of <code>make</code>, because it is
usually better not to mess with a makefile from outside.  However, if
you are running <code>make</code> without a specific makefile, a makefile in
<code>MAKEFILES</code> can do useful things to help the built-in implicit
rules work better, such as defining search paths (see section <a href="make_4.html#Directory-Search">Searching Directories for Prerequisites</a>).
</p>
<p>Some users are tempted to set <code>MAKEFILES</code> in the environment
automatically on login, and program makefiles to expect this to be done.
This is a very bad idea, because such makefiles will fail to work if run by
anyone else.  It is much better to write explicit <code>include</code> directives
in the makefiles.  See section <a href="#Include">Including Other Makefiles</a>.
</p>
<hr size="6">
<a name="MAKEFILE_005fLIST-Variable"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#MAKEFILES-Variable" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Special-Variables" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Makefiles" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Makefiles" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="make_4.html#Rules" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="make.html#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="make_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="make_19.html#Concept-Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="make_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="The-Variable-MAKEFILE_005fLIST"></a>
<h2 class="section">3.5 The Variable <code>MAKEFILE_LIST</code></h2>
<a name="index-makefiles_002c-and-MAKEFILE_005fLIST-variable"></a>
<a name="index-including-_0028MAKEFILE_005fLIST-variable_0029"></a>
<a name="index-MAKEFILE_005fLIST"></a>

<p>As <code>make</code> reads various makefiles, including any obtained from the
<code>MAKEFILES</code> variable, the command line, the default files, or
from <code>include</code> directives, their names will be automatically
appended to the <code>MAKEFILE_LIST</code> variable.  They are added right
before <code>make</code> begins to parse them.
</p>
<p>This means that if the first thing a makefile does is examine the last
word in this variable, it will be the name of the current makefile.
Once the current makefile has used <code>include</code>, however, the last
word will be the just-included makefile.
</p>
<p>If a makefile named <code>Makefile</code> has this content:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">name1 := $(lastword $(MAKEFILE_LIST))

include inc.mk

name2 := $(lastword $(MAKEFILE_LIST))

all:
        @echo name1 = $(name1)
        @echo name2 = $(name2)
</pre></td></tr></table>

<p>then you would expect to see this output:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">name1 = Makefile
name2 = inc.mk
</pre></td></tr></table>

<p>See section <a href="make_8.html#Text-Functions">Functions for String Substitution and Analysis</a>, for more information on the <code>word</code> and
<code>words</code> functions used above.  See section <a href="make_6.html#Flavors">The Two Flavors of Variables</a>, for more information on simply-expanded (<code>:=</code>)
variable definitions.
</p>
<hr size="6">
<a name="Special-Variables"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#MAKEFILE_005fLIST-Variable" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Remaking-Makefiles" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Makefiles" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Makefiles" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="make_4.html#Rules" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="make.html#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="make_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="make_19.html#Concept-Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="make_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Other-Special-Variables"></a>
<h2 class="section">3.6 Other Special Variables</h2>
<a name="index-makefiles_002c-and-special-variables"></a>
<a name="index-special-variables"></a>

<p>GNU <code>make</code> also supports other special variables.  Unless
otherwise documented here, these values lose their special properties
if they are set by a makefile or on the command line.
</p>
<dl compact="compact">
<dd>
<a name="index-_002eDEFAULT_005fGOAL-_0028define-default-goal_0029"></a>
</dd>
<dt> <code>.DEFAULT_GOAL</code></dt>
<dd><p>Sets the default goal to be used if no targets were specified on the
command line (see section <a href="make_9.html#Goals">Arguments to Specify the Goals</a>).  The
<code>.DEFAULT_GOAL</code> variable allows you to discover the current
default goal, restart the default goal selection algorithm by clearing
its value, or to explicitly set the default goal.  The following
example illustrates these cases:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example"># Query the default goal.
ifeq ($(.DEFAULT_GOAL),)
  $(warning no default goal is set)
endif

.PHONY: foo
foo: ; @echo $@

$(warning default goal is $(.DEFAULT_GOAL))

# Reset the default goal.
.DEFAULT_GOAL :=

.PHONY: bar
bar: ; @echo $@

$(warning default goal is $(.DEFAULT_GOAL))

# Set our own.
.DEFAULT_GOAL := foo
</pre></td></tr></table>

<p>This makefile prints:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">no default goal is set
default goal is foo
default goal is bar
foo
</pre></td></tr></table>

<p>Note that assigning more than one target name to <code>.DEFAULT_GOAL</code> is
illegal and will result in an error.
</p>
<a name="index-MAKE_005fRESTARTS-_0028number-of-times-make-has-restarted_0029"></a>
</dd>
<dt> <code>MAKE_RESTARTS</code></dt>
<dd><p>This variable is set only if this instance of <code>make</code> has
restarted (see section <a href="#Remaking-Makefiles">How Makefiles Are Remade</a>): it
will contain the number of times this instance has restarted.  Note
this is not the same as recursion (counted by the <code>MAKELEVEL</code>
variable).  You should not set, modify, or export this variable.
</p>
<a name="index-_002eVARIABLES-_0028list-of-variables_0029"></a>
</dd>
<dt> <code>.VARIABLES</code></dt>
<dd><p>Expands to a list of the <em>names</em> of all global variables defined
so far.  This includes variables which have empty values, as well as
built-in variables (see section <a href="make_10.html#Implicit-Variables">Variables Used by Implicit Rules</a>), but does not include any variables which are only
defined in a target-specific context.  Note that any value you assign
to this variable will be ignored; it will always return its special
value.
</p>

<a name="index-_002eFEATURES-_0028list-of-supported-features_0029"></a>
</dd>
<dt> <code>.FEATURES</code></dt>
<dd><p>Expands to a list of special features supported by this version of
<code>make</code>.  Possible values include:
</p>
<dl compact="compact">
<dt> &lsquo;<samp>archives</samp>&rsquo;</dt>
<dd><p>Supports <code>ar</code> (archive) files using special filename syntax.
See section <a href="make_11.html#Archives">Using <code>make</code> to Update Archive Files</a>.
</p>
</dd>
<dt> &lsquo;<samp>check-symlink</samp>&rsquo;</dt>
<dd><p>Supports the <code>-L</code> (<code>--check-symlink-times</code>) flag.
See section <a href="make_9.html#Options-Summary">Summary of Options</a>.
</p>
</dd>
<dt> &lsquo;<samp>else-if</samp>&rsquo;</dt>
<dd><p>Supports &ldquo;else if&rdquo; non-nested conditionals.  See section <a href="make_7.html#Conditional-Syntax">Syntax of Conditionals</a>.
</p>
</dd>
<dt> &lsquo;<samp>jobserver</samp>&rsquo;</dt>
<dd><p>Supports &ldquo;job server&rdquo; enhanced parallel builds.  See section <a href="make_5.html#Parallel">Parallel Execution</a>.
</p>
</dd>
<dt> &lsquo;<samp>second-expansion</samp>&rsquo;</dt>
<dd><p>Supports secondary expansion of prerequisite lists.
</p>
</dd>
<dt> &lsquo;<samp>order-only</samp>&rsquo;</dt>
<dd><p>Supports order-only prerequisites.  See section <a href="make_4.html#Prerequisite-Types">Types of Prerequisites</a>.
</p>
</dd>
<dt> &lsquo;<samp>target-specific</samp>&rsquo;</dt>
<dd><p>Supports target-specific and pattern-specific variable assignments.
See section <a href="make_6.html#Target_002dspecific">Target-specific Variable Values</a>.
</p>
</dd>
</dl>

<a name="index-_002eINCLUDE_005fDIRS-_0028list-of-include-directories_0029"></a>
</dd>
<dt> <code>.INCLUDE_DIRS</code></dt>
<dd><p>Expands to a list of directories that <code>make</code> searches for
included makefiles (see section <a href="#Include">Including Other Makefiles</a>).
</p>
</dd>
</dl>

<hr size="6">
<a name="Remaking-Makefiles"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Special-Variables" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Overriding-Makefiles" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Makefiles" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Makefiles" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="make_4.html#Rules" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="make.html#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="make_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="make_19.html#Concept-Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="make_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="How-Makefiles-Are-Remade"></a>
<h2 class="section">3.7 How Makefiles Are Remade</h2>

<a name="index-updating-makefiles"></a>
<a name="index-remaking-makefiles"></a>
<a name="index-makefile_002c-remaking-of"></a>
<p>Sometimes makefiles can be remade from other files, such as RCS or SCCS
files.  If a makefile can be remade from other files, you probably want
<code>make</code> to get an up-to-date version of the makefile to read in.
</p>
<p>To this end, after reading in all makefiles, <code>make</code> will consider
each as a goal target and attempt to update it.  If a makefile has a
rule which says how to update it (found either in that very makefile or
in another one) or if an implicit rule applies to it (see section <a href="make_10.html#Implicit-Rules">Using Implicit Rules</a>), it will be updated if necessary.  After
all makefiles have been checked, if any have actually been changed,
<code>make</code> starts with a clean slate and reads all the makefiles over
again.  (It will also attempt to update each of them over again, but
normally this will not change them again, since they are already up to
date.)
</p>
<p>If you know that one or more of your makefiles cannot be remade and you
want to keep <code>make</code> from performing an implicit rule search on
them, perhaps for efficiency reasons, you can use any normal method of
preventing implicit rule lookup to do so.  For example, you can write an
explicit rule with the makefile as the target, and an empty command
string (see section <a href="make_5.html#Empty-Commands">Using Empty Commands</a>).
</p>
<p>If the makefiles specify a double-colon rule to remake a file with
commands but no prerequisites, that file will always be remade
(see section <a href="make_4.html#Double_002dColon">Double-Colon Rules</a>).  In the case of makefiles, a makefile that has a
double-colon rule with commands but no prerequisites will be remade every
time <code>make</code> is run, and then again after <code>make</code> starts over
and reads the makefiles in again.  This would cause an infinite loop:
<code>make</code> would constantly remake the makefile, and never do anything
else.  So, to avoid this, <code>make</code> will <strong>not</strong> attempt to
remake makefiles which are specified as targets of a double-colon rule
with commands but no prerequisites.
</p>
<p>If you do not specify any makefiles to be read with &lsquo;<samp>-f</samp>&rsquo; or
&lsquo;<samp>--file</samp>&rsquo; options, <code>make</code> will try the default makefile names;
see section <a href="#Makefile-Names">What Name to Give Your Makefile</a>.  Unlike
makefiles explicitly requested with &lsquo;<samp>-f</samp>&rsquo; or &lsquo;<samp>--file</samp>&rsquo; options,
<code>make</code> is not certain that these makefiles should exist.  However,
if a default makefile does not exist but can be created by running
<code>make</code> rules, you probably want the rules to be run so that the
makefile can be used.
</p>
<p>Therefore, if none of the default makefiles exists, <code>make</code> will try
to make each of them in the same order in which they are searched for
(see section <a href="#Makefile-Names">What Name to Give Your Makefile</a>)
until it succeeds in making one, or it runs out of names to try.  Note
that it is not an error if <code>make</code> cannot find or make any makefile;
a makefile is not always necessary.
</p>
<p>When you use the &lsquo;<samp>-t</samp>&rsquo; or &lsquo;<samp>--touch</samp>&rsquo; option
(see section <a href="make_9.html#Instead-of-Execution">Instead of Executing the Commands</a>),
you would not want to use an out-of-date makefile to decide which
targets to touch.  So the &lsquo;<samp>-t</samp>&rsquo; option has no effect on updating
makefiles; they are really updated even if &lsquo;<samp>-t</samp>&rsquo; is specified.
Likewise, &lsquo;<samp>-q</samp>&rsquo; (or &lsquo;<samp>--question</samp>&rsquo;) and &lsquo;<samp>-n</samp>&rsquo; (or
&lsquo;<samp>--just-print</samp>&rsquo;) do not prevent updating of makefiles, because an
out-of-date makefile would result in the wrong output for other targets.
Thus, &lsquo;<samp>make -f mfile -n foo</samp>&rsquo; will update &lsquo;<tt>mfile</tt>&rsquo;, read it in,
and then print the commands to update &lsquo;<tt>foo</tt>&rsquo; and its prerequisites
without running them.  The commands printed for &lsquo;<tt>foo</tt>&rsquo; will be those
specified in the updated contents of &lsquo;<tt>mfile</tt>&rsquo;.
</p>
<p>However, on occasion you might actually wish to prevent updating of even
the makefiles.  You can do this by specifying the makefiles as goals in
the command line as well as specifying them as makefiles.  When the
makefile name is specified explicitly as a goal, the options &lsquo;<samp>-t</samp>&rsquo;
and so on do apply to them.
</p>
<p>Thus, &lsquo;<samp>make -f mfile -n mfile foo</samp>&rsquo; would read the makefile
&lsquo;<tt>mfile</tt>&rsquo;, print the commands needed to update it without actually
running them, and then print the commands needed to update &lsquo;<tt>foo</tt>&rsquo;
without running them.  The commands for &lsquo;<tt>foo</tt>&rsquo; will be those
specified by the existing contents of &lsquo;<tt>mfile</tt>&rsquo;.
</p>
<hr size="6">
<a name="Overriding-Makefiles"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Remaking-Makefiles" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Reading-Makefiles" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Makefiles" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Makefiles" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="make_4.html#Rules" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="make.html#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="make_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="make_19.html#Concept-Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="make_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Overriding-Part-of-Another-Makefile"></a>
<h2 class="section">3.8 Overriding Part of Another Makefile</h2>

<a name="index-overriding-makefiles"></a>
<a name="index-makefile_002c-overriding"></a>
<p>Sometimes it is useful to have a makefile that is mostly just like
another makefile.  You can often use the &lsquo;<samp>include</samp>&rsquo; directive to
include one in the other, and add more targets or variable definitions.
However, if the two makefiles give different commands for the same
target, <code>make</code> will not let you just do this.  But there is another way.
</p>
<a name="index-match_002danything-rule_002c-used-to-override"></a>
<p>In the containing makefile (the one that wants to include the other),
you can use a match-anything pattern rule to say that to remake any
target that cannot be made from the information in the containing
makefile, <code>make</code> should look in another makefile.
See section <a href="make_10.html#Pattern-Rules">Defining and Redefining Pattern Rules</a>, for more information on pattern rules.
</p>
<p>For example, if you have a makefile called &lsquo;<tt>Makefile</tt>&rsquo; that says how
to make the target &lsquo;<samp>foo</samp>&rsquo; (and other targets), you can write a
makefile called &lsquo;<tt>GNUmakefile</tt>&rsquo; that contains:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">foo:
        frobnicate &gt; foo

%: force
        @$(MAKE) -f Makefile $@
force: ;
</pre></td></tr></table>

<p>If you say &lsquo;<samp>make foo</samp>&rsquo;, <code>make</code> will find &lsquo;<tt>GNUmakefile</tt>&rsquo;,
read it, and see that to make &lsquo;<tt>foo</tt>&rsquo;, it needs to run the command
&lsquo;<samp>frobnicate &gt; foo</samp>&rsquo;.  If you say &lsquo;<samp>make bar</samp>&rsquo;, <code>make</code> will
find no way to make &lsquo;<tt>bar</tt>&rsquo; in &lsquo;<tt>GNUmakefile</tt>&rsquo;, so it will use the
commands from the pattern rule: &lsquo;<samp>make -f Makefile bar</samp>&rsquo;.  If
&lsquo;<tt>Makefile</tt>&rsquo; provides a rule for updating &lsquo;<tt>bar</tt>&rsquo;, <code>make</code>
will apply the rule.  And likewise for any other target that
&lsquo;<tt>GNUmakefile</tt>&rsquo; does not say how to make.
</p>
<p>The way this works is that the pattern rule has a pattern of just
&lsquo;<samp>%</samp>&rsquo;, so it matches any target whatever.  The rule specifies a
prerequisite &lsquo;<tt>force</tt>&rsquo;, to guarantee that the commands will be run even
if the target file already exists.  We give &lsquo;<tt>force</tt>&rsquo; target empty
commands to prevent <code>make</code> from searching for an implicit rule to
build it&mdash;otherwise it would apply the same match-anything rule to
&lsquo;<tt>force</tt>&rsquo; itself and create a prerequisite loop!
</p>
<hr size="6">
<a name="Reading-Makefiles"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Overriding-Makefiles" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Secondary-Expansion" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Makefiles" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Makefiles" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="make_4.html#Rules" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="make.html#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="make_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="make_19.html#Concept-Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="make_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="How-make-Reads-a-Makefile"></a>
<h2 class="section">3.9 How <code>make</code> Reads a Makefile</h2>
<a name="index-reading-makefiles"></a>
<a name="index-makefile_002c-parsing"></a>

<p>GNU <code>make</code> does its work in two distinct phases.  During the first
phase it reads all the makefiles, included makefiles, etc. and
internalizes all the variables and their values, implicit and explicit
rules, and constructs a dependency graph of all the targets and their
prerequisites.  During the second phase, <code>make</code> uses these internal
structures to determine what targets will need to be rebuilt and to
invoke the rules necessary to do so.
</p>
<p>It&rsquo;s important to understand this two-phase approach because it has a
direct impact on how variable and function expansion happens; this is
often a source of some confusion when writing makefiles.  Here we will
present a summary of the phases in which expansion happens for different
constructs within the makefile.  We say that expansion is
<em>immediate</em> if it happens during the first phase: in this case
<code>make</code> will expand any variables or functions in that section of a
construct as the makefile is parsed.  We say that expansion is
<em>deferred</em> if expansion is not performed immediately.  Expansion of
deferred construct is not performed until either the construct appears
later in an immediate context, or until the second phase.
</p>
<p>You may not be familiar with some of these constructs yet.  You can
reference this section as you become familiar with them, in later
chapters.
</p>
<a name="Variable-Assignment"></a>
<h3 class="subheading">Variable Assignment</h3>
<a name="index-_002b_003d_002c-expansion"></a>
<a name="index-_003d_002c-expansion"></a>
<a name="index-_003f_003d_002c-expansion"></a>
<a name="index-_002b_003d_002c-expansion-1"></a>
<a name="index-define_002c-expansion"></a>

<p>Variable definitions are parsed as follows:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example"><var>immediate</var> = <var>deferred</var>
<var>immediate</var> ?= <var>deferred</var>
<var>immediate</var> := <var>immediate</var>
<var>immediate</var> += <var>deferred</var> or <var>immediate</var>

define <var>immediate</var>
  <var>deferred</var>
endef
</pre></td></tr></table>

<p>For the append operator, &lsquo;<samp>+=</samp>&rsquo;, the right-hand side is considered
immediate if the variable was previously set as a simple variable
(&lsquo;<samp>:=</samp>&rsquo;), and deferred otherwise.
</p>
<a name="Conditional-Statements"></a>
<h3 class="subheading">Conditional Statements</h3>
<a name="index-ifdef_002c-expansion"></a>
<a name="index-ifeq_002c-expansion"></a>
<a name="index-ifndef_002c-expansion"></a>
<a name="index-ifneq_002c-expansion"></a>

<p>All instances of conditional syntax are parsed immediately, in their
entirety; this includes the <code>ifdef</code>, <code>ifeq</code>, <code>ifndef</code>,
and <code>ifneq</code> forms.  Of course this means that automatic variables
cannot be used in conditional statements, as automatic variables are
not set until the command script for that rule is invoked.  If you
need to use automatic variables in a conditional you <em>must</em> use
shell conditional syntax, in your command script proper, for these
tests, not <code>make</code> conditionals.
</p>
<a name="Rule-Definition"></a>
<h3 class="subheading">Rule Definition</h3>
<a name="index-target_002c-expansion"></a>
<a name="index-prerequisite_002c-expansion"></a>
<a name="index-implicit-rule_002c-expansion"></a>
<a name="index-pattern-rule_002c-expansion"></a>
<a name="index-explicit-rule_002c-expansion"></a>

<p>A rule is always expanded the same way, regardless of the form:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example"><var>immediate</var> : <var>immediate</var> ; <var>deferred</var>
	<var>deferred</var>
</pre></td></tr></table>

<p>That is, the target and prerequisite sections are expanded immediately,
and the commands used to construct the target are always deferred.  This
general rule is true for explicit rules, pattern rules, suffix rules,
static pattern rules, and simple prerequisite definitions.
</p>
<hr size="6">
<a name="Secondary-Expansion"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Reading-Makefiles" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="make_4.html#Rules" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Makefiles" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Makefiles" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="make_4.html#Rules" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="make.html#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="make_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="make_19.html#Concept-Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="make_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Secondary-Expansion-1"></a>
<h2 class="section">3.10 Secondary Expansion</h2>
<a name="index-secondary-expansion"></a>
<a name="index-expansion_002c-secondary"></a>

<a name="index-_002eSECONDEXPANSION"></a>
<p>In the previous section we learned that GNU <code>make</code> works in two
distinct phases: a read-in phase and a target-update phase
(see section <a href="#Reading-Makefiles">How <code>make</code> Reads a Makefile</a>).  GNU
make also has the ability to enable a <em>second expansion</em> of the
prerequisites (only) for some or all targets defined in the makefile.
In order for this second expansion to occur, the special target
<code>.SECONDEXPANSION</code> must be defined before the first prerequisite
list that makes use of this feature.
</p>
<p>If that special target is defined then in between the two phases
mentioned above, right at the end of the read-in phase, all the
prerequisites of the targets defined after the special target are
expanded a <em>second time</em>.  In most circumstances this secondary
expansion will have no effect, since all variable and function
references will have been expanded during the initial parsing of the
makefiles.  In order to take advantage of the secondary expansion
phase of the parser, then, it&rsquo;s necessary to <em>escape</em> the
variable or function reference in the makefile.  In this case the
first expansion merely un-escapes the reference but doesn&rsquo;t expand it,
and expansion is left to the secondary expansion phase.  For example,
consider this makefile:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">.SECONDEXPANSION:
ONEVAR = onefile
TWOVAR = twofile
myfile: $(ONEVAR) $$(TWOVAR)
</pre></td></tr></table>

<p>After the first expansion phase the prerequisites list of the
&lsquo;<tt>myfile</tt>&rsquo; target will be <code>onefile</code> and <code>$(TWOVAR)</code>; the
first (unescaped) variable reference to <var>ONEVAR</var> is expanded,
while the second (escaped) variable reference is simply unescaped,
without being recognized as a variable reference.  Now during the
secondary expansion the first word is expanded again but since it
contains no variable or function references it remains the static
value &lsquo;<tt>onefile</tt>&rsquo;, while the second word is now a normal reference
to the variable <var>TWOVAR</var>, which is expanded to the value
&lsquo;<tt>twofile</tt>&rsquo;.  The final result is that there are two prerequisites,
&lsquo;<tt>onefile</tt>&rsquo; and &lsquo;<tt>twofile</tt>&rsquo;.
</p>
<p>Obviously, this is not a very interesting case since the same result
could more easily have been achieved simply by having both variables
appear, unescaped, in the prerequisites list.  One difference becomes
apparent if the variables are reset; consider this example:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">.SECONDEXPANSION:
AVAR = top
onefile: $(AVAR)
twofile: $$(AVAR)
AVAR = bottom
</pre></td></tr></table>

<p>Here the prerequisite of &lsquo;<tt>onefile</tt>&rsquo; will be expanded immediately,
and resolve to the value &lsquo;<tt>top</tt>&rsquo;, while the prerequisite of
&lsquo;<tt>twofile</tt>&rsquo; will not be full expanded until the secondary expansion
and yield a value of &lsquo;<tt>bottom</tt>&rsquo;.
</p>
<p>This is marginally more exciting, but the true power of this feature
only becomes apparent when you discover that secondary expansions
always take place within the scope of the automatic variables for that
target.  This means that you can use variables such as <code>$@</code>,
<code>$*</code>, etc. during the second expansion and they will have their
expected values, just as in the command script.  All you have to do is
defer the expansion by escaping the <code>$</code>.  Also, secondary
expansion occurs for both explicit and implicit (pattern) rules.
Knowing this, the possible uses for this feature increase
dramatically.  For example:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">.SECONDEXPANSION:
main_OBJS := main.o try.o test.o
lib_OBJS := lib.o api.o

main lib: $$($$@_OBJS)
</pre></td></tr></table>

<p>Here, after the initial expansion the prerequisites of both the
&lsquo;<tt>main</tt>&rsquo; and &lsquo;<tt>lib</tt>&rsquo; targets will be <code>$($@_OBJS)</code>.  During
the secondary expansion, the <code>$@</code> variable is set to the name of
the target and so the expansion for the &lsquo;<tt>main</tt>&rsquo; target will yield
<code>$(main_OBJS)</code>, or <code>main.o try.o test.o</code>, while the
secondary expansion for the &lsquo;<tt>lib</tt>&rsquo; target will yield
<code>$(lib_OBJS)</code>, or <code>lib.o api.o</code>.
</p>
<p>You can also mix functions here, as long as they are properly escaped:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">main_SRCS := main.c try.c test.c
lib_SRCS := lib.c api.c

.SECONDEXPANSION:
main lib: $$(patsubst %.c,%.o,$$($$@_SRCS))
</pre></td></tr></table>

<p>This version allows users to specify source files rather than object
files, but gives the same resulting prerequisites list as the previous
example.
</p>
<p>Evaluation of automatic variables during the secondary expansion
phase, especially of the target name variable <code>$$@</code>, behaves
similarly to evaluation within command scripts.  However, there are
some subtle differences and &ldquo;corner cases&rdquo; which come into play for
the different types of rule definitions that <code>make</code> understands.
The subtleties of using the different automatic variables are
described below.
</p>
<a name="Secondary-Expansion-of-Explicit-Rules"></a>
<h3 class="subheading">Secondary Expansion of Explicit Rules</h3>
<a name="index-secondary-expansion-and-explicit-rules"></a>
<a name="index-explicit-rules_002c-secondary-expansion-of"></a>

<p>During the secondary expansion of explicit rules, <code>$$@</code> and
<code>$$%</code> evaluate, respectively, to the file name of the target and,
when the target is an archive member, the target member name.  The
<code>$$&lt;</code> variable evaluates to the first prerequisite in the first
rule for this target.  <code>$$^</code> and <code>$$+</code> evaluate to the list
of all prerequisites of rules <em>that have already appeared</em> for
the same target (<code>$$+</code> with repetitions and <code>$$^</code>
without).  The following example will help illustrate these behaviors:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">.SECONDEXPANSION:

foo: foo.1 bar.1 $$&lt; $$^ $$+    # line #1

foo: foo.2 bar.2 $$&lt; $$^ $$+    # line #2

foo: foo.3 bar.3 $$&lt; $$^ $$+    # line #3
</pre></td></tr></table>

<p>In the first prerequisite list, all three variables (<code>$$&lt;</code>,
<code>$$^</code>, and <code>$$+</code>) expand to the empty string.  In the
second, they will have values <code>foo.1</code>, <code>foo.1 bar.1</code>, and
<code>foo.1 bar.1</code> respectively.  In the third they will have values
<code>foo.1</code>, <code>foo.1 bar.1 foo.2 bar.2</code>, and <code>foo.1 bar.1
foo.2 bar.2</code> respectively.
</p>
<p>Rules undergo secondary expansion in makefile order, except that
the rule with the command script is always evaluated last.
</p>
<p>The variables <code>$$?</code> and <code>$$*</code> are not available and expand
to the empty string.
</p>
<a name="Secondary-Expansion-of-Static-Pattern-Rules"></a>
<h3 class="subheading">Secondary Expansion of Static Pattern Rules</h3>
<a name="index-secondary-expansion-and-static-pattern-rules"></a>
<a name="index-static-pattern-rules_002c-secondary-expansion-of"></a>

<p>Rules for secondary expansion of static pattern rules are identical to
those for explicit rules, above, with one exception: for static
pattern rules the <code>$$*</code> variable is set to the pattern stem.  As
with explicit rules, <code>$$?</code> is not available and expands to the
empty string.
</p>
<a name="Secondary-Expansion-of-Implicit-Rules"></a>
<h3 class="subheading">Secondary Expansion of Implicit Rules</h3>
<a name="index-secondary-expansion-and-implicit-rules"></a>
<a name="index-implicit-rules_002c-secondary-expansion-of"></a>

<p>As <code>make</code> searches for an implicit rule, it substitutes the stem
and then performs secondary expansion for every rule with a matching
target pattern.  The value of the automatic variables is derived in
the same fashion as for static pattern rules.  As an example:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">.SECONDEXPANSION:

foo: bar

foo foz: fo%: bo%

%oo: $$&lt; $$^ $$+ $$*
</pre></td></tr></table>

<p>When the implicit rule is tried for target &lsquo;<tt>foo</tt>&rsquo;, <code>$$&lt;</code>
expands to &lsquo;<tt>bar</tt>&rsquo;, <code>$$^</code> expands to &lsquo;<tt>bar boo</tt>&rsquo;,
<code>$$+</code> also expands to &lsquo;<tt>bar boo</tt>&rsquo;, and <code>$$*</code> expands to
&lsquo;<tt>f</tt>&rsquo;.
</p>
<p>Note that the directory prefix (D), as described in <a href="make_10.html#Implicit-Rule-Search">Implicit Rule Search Algorithm</a>, is appended (after
expansion) to all the patterns in the prerequisites list.  As an
example:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">.SECONDEXPANSION:

/tmp/foo.o:

%.o: $$(addsuffix /%.c,foo bar) foo.h
</pre></td></tr></table>

<p>The prerequisite list after the secondary expansion and directory
prefix reconstruction will be &lsquo;<tt>/tmp/foo/foo.c /tmp/var/bar/foo.c
foo.h</tt>&rsquo;.  If you are not interested in this reconstruction, you can use
<code>$$*</code> instead of <code>%</code> in the prerequisites list.
</p>
<hr size="6">
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Makefiles" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="make_4.html#Rules" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="make.html#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="make_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="make_19.html#Concept-Index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="make_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<p>
 <font size="-1">
  This document was generated on <i>October 20, 2021</i> using <a href="http://www.nongnu.org/texi2html/"><i>texi2html 1.82</i></a>.
 </font>
 <br>

</p>
</body>
</html>
